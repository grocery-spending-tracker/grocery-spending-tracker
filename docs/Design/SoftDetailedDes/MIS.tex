\documentclass[12pt, titlepage]{article}

\usepackage{amsmath, mathtools}

\usepackage[round]{natbib}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage{caption}
\usepackage{fullpage}

\hypersetup{
bookmarks=true,     % show bookmarks bar?
colorlinks=true,       % false: boxed links; true: colored links
linkcolor=red,          % color of internal links (change box color with linkbordercolor)
citecolor=blue,      % color of links to bibliography
filecolor=magenta,  % color of file links
urlcolor=cyan          % color of external links
}

\usepackage{array}

\externaldocument{../../SRS/SRS}

\input{../../Comments}
\input{../../Common}

\begin{document}

\title{Module Interface Specification for \progname{}}

\author{\authname}

\date{\today}

\maketitle

\pagenumbering{roman}

\section{Revision History}

\begin{tabularx}{\textwidth}{p{3cm}p{2cm}X}
\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
\midrule
Date 1 & 1.0 & Notes\\
Date 2 & 1.1 & Notes\\
\bottomrule
\end{tabularx}

~\newpage

\section{Symbols, Abbreviations and Acronyms}

See SRS Documentation at \url{https://github.com/r-yeh/grocery-spending-tracker/blob/master/docs/SRS/SRS.pdf}
\newline
\renewcommand{\arraystretch}{1.2}
\begin{tabular}{l l} 
  \toprule		
  \textbf{symbol} & \textbf{description}\\
  \midrule 
  SRS & Software Requirements Specification\\
  MIS & Module Interface Specification \\
  SKU & Stock Keeping Unit: ID of Product Used by Retailers \\
  UPC & Universal Product Code: widely used barcode symbology for tracking trade items in stores \\
  JWT & JSON Web Token \\
  \bottomrule
\end{tabular}\\

\newpage

\tableofcontents

\newpage

\pagenumbering{arabic}

\section{Introduction}

The following document details the Module Interface Specifications for
\wss{Fill in your project name and description}

Complementary documents include the System Requirement Specifications
and Module Guide.  The full documentation and implementation can be
found at \url{...}.  \wss{provide the url for your repo}

\section{Notation}

\wss{You should describe your notation.  You can use what is below as
  a starting point.}

The structure of the MIS for modules comes from \citet{HoffmanAndStrooper1995},
with the addition that template modules have been adapted from
\cite{GhezziEtAl2003}.  The mathematical notation comes from Chapter 3 of
\citet{HoffmanAndStrooper1995}.  For instance, the symbol := is used for a
multiple assignment statement and conditional rules follow the form $(c_1
\Rightarrow r_1 | c_2 \Rightarrow r_2 | ... | c_n \Rightarrow r_n )$.

The following table summarizes the primitive data types used by \progname. 

\begin{center}
\renewcommand{\arraystretch}{1.2}
\noindent 
\begin{tabular}{l l p{7.5cm}} 
\toprule 
\textbf{Data Type} & \textbf{Notation} & \textbf{Description}\\ 
\midrule
character & char & a single symbol or digit\\
integer & $\mathbb{Z}$ & a number without a fractional component in (-$\infty$, $\infty$) \\
natural number & $\mathbb{N}$ & a number without a fractional component in [1, $\infty$) \\
real & $\mathbb{R}$ & any number in (-$\infty$, $\infty$)\\
\bottomrule
\end{tabular} 
\end{center}

\noindent
The specification of \progname \ uses some derived data types: sequences, strings, and
tuples. Sequences are lists filled with elements of the same data type. Strings
are sequences of characters. Tuples contain a list of values, potentially of
different types. In addition, \progname \ uses functions, which
are defined by the data types of their inputs and outputs. Local functions are
described by giving their type signature followed by their specification.

\section{Module Decomposition}

The following table is taken directly from the Module Guide document for this project.

\begin{table}[h!]
\centering
\begin{tabular}{p{0.3\textwidth} p{0.6\textwidth}}
\toprule
\textbf{Level 1} & \textbf{Level 2}\\
\midrule

{Hardware-Hiding} & ~ \\
\midrule

\multirow{7}{0.3\textwidth}{Behaviour-Hiding} & Receipt Vision Module (OCR)\\
& Receipt Extraction Module\\
& Location Management Module\\
& User Analytics Module\\
& Users Module\\
& Authentication Module\\
\midrule

\multirow{3}{0.3\textwidth}{Software Decision} & Recommendation Engine\\
& Classification Engine\\
& Database Driver Module\\
\bottomrule

\end{tabular}
\caption{Module Hierarchy}
\label{TblMH}
\end{table}

\newpage
~\newpage

\section{MIS of Database Driver Module} \label{mDBDriver}
Module for hiding database implementation. Database schema and tables are detailed in Section \ref{dbAppendix}

\subsection{Module}
dbModule

\subsection{Uses}
None

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{4cm} p{4cm} p{4cm} p{3cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
insert & String$^2$ & - & - \\
update & String$^3$ & - & - \\
delete & String$^2$ & - & - \\
select & String$^3$ & String & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
None

\subsubsection{Environment Variables}
\textbf{Relational Database} db

\subsubsection{Assumptions}
The schema is set up as described in Section \ref{dbAppendix}\\
The connection to the database is established with necessary permissions.

\subsubsection{Access Routine Semantics}

\noindent \wss{insert}(\textit{tableName, values}):
\begin{itemize}
\item transition: the target table in \textit{db} specified by \textit{tableName} adds \textit{values}.
\item output: none
\item exception: none
\end{itemize}

\noindent \wss{update}(\textit{tableName, values, conditions}):
\begin{itemize}
\item transition: the target items in \textit{db} specified by \textit{tableName} and \textit{conditions} is updated with \textit{values}.
\item output: none
\item exception: none
\end{itemize}

\noindent \wss{delete}(\textit{tableName, conditions}):
\begin{itemize}
\item transition: the target items in \textit{db} specified by \textit{tableName} and \textit{conditions} are deleted.
\item output: none
\item exception: none
\end{itemize}

\noindent \wss{select}(\textit{fields, tableName, conditions}):
\begin{itemize}
\item transition: none
\item output: $out \coloneqq data$, where data describes the fields specified by \textit{fields} of the target items specified by \textit{tableName} and \textit{conditions} in db.
\item exception: none
\end{itemize}

\subsubsection{Local Functions}
None

\newpage

\section{MIS of Recommendation Module} \label{mRecommendation}

Module for recommending user purchases.

\subsection{Module}

recommendationModule

\subsection{Uses}

Database Driver Module (Section \ref{mDBDriver})

\subsection{Syntax}

\subsubsection{Exported Constants}

None

\subsubsection{Exported Access Programs}

\begin{center}
    \begin{tabular}{p{5cm} p{4cm} p{3cm} p{4cm}}
    \hline
    \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
    \hline
    collectItemData & Item & - & InvalidDataFormatException \\
    getCheaperAlternatives & itemId & List$<$itemId$>$ & - \\
    getRecommendationDetails & itemId & Item & - \\
    \hline
    \end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

None

\subsubsection{Environment Variables}

None

\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent collectItemData(\textit{Item}):
\begin{itemize}
  \item transition: Updates the module's internal data structure with the new \textit{Item} data.
  \item output: none
  \item exception: $exc := \textit{InvalidDataFormatException}$, if \textit{Item} does not adhere to the expected format.
\end{itemize}

\noindent getCheaperAlternatives(\textit{itemId}):
\begin{itemize}
  \item transition: none
  \item output: $out := \textit{getCheaperAlternatives}(\textit{itemId})$ 
  \item exception: none
\end{itemize}

\noindent getRecommendationDetails(\textit{itemId}):
\begin{itemize}
  \item transition: none
  \item output: $out := \textit{getItemDetails}(\textit{itemId})$
  \item exception: none
\end{itemize}

\subsubsection{Local Functions}

\noindent getCheaperAlternatives(\textit{itemId}):
\begin{itemize}
  \item transition: none
  \item output: $out := \textit{list of item IDs that are cheaper alternatives to the item identified by} \, \textit{itemId}$
  \item exception: none
\end{itemize}

\noindent getItemDetails(\textit{itemId}):
\begin{itemize}
  \item transition: none
  \item output: $out := \textit{detailed information of the item identified by} \, \textit{itemId}$
  \item exception: none
\end{itemize}

\newpage

\section{MIS of Receipt Vision Module} \label{mVision}

The Receipt Vision Module is responsible for providing methods and logic related to image
capture of the receipt. This includes responsibilities like handling device permissions and camera access.

\subsection{Module}

receiptVision

\subsection{Uses}

None

\subsection{Syntax}

\subsubsection{Exported Constants}

None

\subsubsection{Exported Access Programs}

\begin{center}
  \begin{tabular}{p{5cm} p{4cm} p{3cm} p{4cm}}
  \hline
  \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
  \hline
  requestCameraPermission & - & - & - \\
  didChangeAppLifeCycle & appLifecycle & - & - \\
  scanReceipt & - & String & noPermissionException \\
  \hline
  \end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

\textit{appLifecycle}: Tracks module activity on the user's device. \\
\textit{isPermissionGranted}: Stores camera permission status. \\
\textit{selectedCamera}: Stores data on which camera to use.

\subsubsection{Environment Variables}

User Camera \\
User Display

\subsubsection{Assumptions}

\begin{itemize}
  \item Application will always be used on a device with a camera.
\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent requestCameraPermission():
\begin{itemize}
  \item transition: Request camera permission and update \textit{isPermissionGranted} accordingly.
  \item output: none
  \item exception: none
  \end{itemize}

\noindent didChangeAppLifeCycle(\textit{appLifecycle}):
\begin{itemize}
  \item transition: $transition := (\neg isPermissionGranted) \Rightarrow$ no action is performed $|$\\
                    $(isPermissionGranted \land appLifecycle = active) \Rightarrow$ Turn on device camera $|$\\
                    $(isPermissionGranted \land appLifecycle = inactive) \Rightarrow$ Turn off device camera
  \item output: none
  \item exception: none
\end{itemize}

\noindent scanReceipt():
\begin{itemize}
  \item transition: Display camera preview and interface for image capture.
  \item output: $out := isPermissionGranted \Rightarrow$ take picture with camera and parse text
  \item exception: $exc := (\neg isPermissionGranted) \Rightarrow$ noPermissionException
\end{itemize}

\subsubsection{Local Functions}

\noindent initializeCamera(availableCameras):
\begin{itemize}
  \item transition: Let $findBackFacingCamera = \forall cameras \exists camera \in cameras : camera.direction = back$ \\
                    $transition := (\neg isPermissionGranted) \Rightarrow$ no action is performed $|$\\
                    $isPermissionGranted \Rightarrow findBackFacingCamera(availableCameras) \Rightarrow $ \\
                    $selectedCamera = camera$
  \item output: none
  \item exception: none
\end{itemize}

\newpage

\section{MIS of Receipt Extraction Module} \label{mExtraction}

The Receipt Extraction Module contains methods related to extracting relevant data such as grocery items,
prices, and date of transaction from a parsed receipt.

\subsection{Module}

receiptExtraction

\subsection{Uses}

Database Driver Module (Section \ref{mDBDriver})

\subsection{Syntax}

\subsubsection{Exported Constants}

None

\subsubsection{Exported Types}

\textbf{Item}

\begin{table}[H]
  \begin{tabular}{|p{0.25\textwidth}|p{0.25\textwidth}|p{0.40\textwidth}|}
    \hline
    \textbf{Output Name} & \textbf{Output Type} & \textbf{Description} \\
    \hline
    itemKey & String & SKU of the purchased item \\
    \hline
    itemDesc & String & Name of the product on the receipt \\
    \hline
    price & Float & Purchase price of the product \\
    \hline
    taxed & Boolean & Whether an item is taxed (Some groceries in Canada aren't taxed) \\
    \hline
  \end{tabular}
\end{table}

\textbf{UpdatedItem}

\begin{table}[H]
  \begin{tabular}{|p{0.25\textwidth}|p{0.25\textwidth}|p{0.40\textwidth}|}
    \hline
    \textbf{Output Name} & \textbf{Output Type} & \textbf{Description} \\
    \hline
    itemKey & Optional$<$String$>$ & SKU of the purchased item \\
    \hline
    itemDesc & Optional$<$String$>$ & Name of the product on the receipt \\
    \hline
    price & Optional$<$Float$>$ & Purchase price of the product \\
    \hline
    taxed & Boolean & Whether an item is taxed (Some groceries in Canada aren't taxed) \\
    \hline
  \end{tabular}
\end{table}

\textbf{GroceryTrip}

\begin{table}[H]
  \begin{tabular}{|p{0.25\textwidth}|p{0.25\textwidth}|p{0.40\textwidth}|}
    \hline
    \textbf{Output Name} & \textbf{Output Type} & \textbf{Description} \\
    \hline
    userID & String & ID of the user \\
    \hline
    dateTime & String & Date and time of transaction \\
    \hline
    location & String & Address of the grocery store location \\
    \hline
    items & List$<$Item$>$ & List of purchased grocery items from receipt \\
    \hline
    subtotal & Float & Total spent on grocery trip before tax \\
    \hline
    total & Float & Total spent on grocery trip \\
    \hline
    tripDesc & Optional$<$String$>$ & Notes made by the user \\
    \hline
  \end{tabular}
\end{table}

\textbf{UpdatedGroceryTrip}

\begin{table}[H]
  \begin{tabular}{|p{0.25\textwidth}|p{0.35\textwidth}|p{0.3\textwidth}|}
    \hline
    \textbf{Output Name} & \textbf{Output Type} & \textbf{Description} \\
    \hline
    dateTime & Optional$<$String$>$ & Date and time of transaction \\
    \hline
    location & Optional$<$String$>$ & Address of the grocery store location \\
    \hline
    items & Optional$<$List$<$UpdatedItem$>$$>$ & List of purchased grocery items from receipt \\
    \hline
    subtotal & Optional$<$Float$>$ & Total spent on grocery trip before tax \\
    \hline
    total & Optional$<$Float$>$ & Total spent on grocery trip \\
    \hline
    tripDesc & Optional$<$String$>$ & Notes made by the user \\
    \hline
  \end{tabular}
\end{table}

\subsubsection{Exported Access Programs}

\begin{center}
  \begin{tabular}{p{5cm} p{4cm} p{3cm} p{4cm}}
  \hline
  \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
  \hline
  createGroceryTrip & String & GroceryTrip & -\\
  updateGroceryTrip & UpdatedGroceryTrip & GroceryTrip & -\\
  createItem & String & Item & -\\
  updateItem & UpdatedItem & Item & -\\
  confirmGroceryTrip & GroceryTrip & JSON & -\\
  \hline
  \end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

None

\subsubsection{Environment Variables}

User Display

\subsubsection{Assumptions}
\begin{itemize}
  \item \textit{createItem} will always be working with strings of the format "\textit{itemKey itemDesc price}"
\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent createGroceryTrip(\textit{receiptData}):
\begin{itemize}
  \item transition: Extracts \textit{GroceryTrip} data, redirects user to new page where confirmation
of extracted data can be performed.
  \item output: $out :=$ new GroceryTrip(getDateTime(\textit{receiptData}), getLocation(\textit{receiptData}),
                        getItems(\textit{receiptData}), getSubtotal(\textit{receiptData}), getTotal(\textit{receiptData}), "")
  \item exception: none
\end{itemize}

\noindent updateGroceryTrip(\textit{updatedTrip}):
\begin{itemize}
  \item transition: Updates \textit{GroceryTrip}, reloads confirmation page.
  \item output: $out :=$ Update all fields of the \textit{GroceryTrip} object with non-empty fields of \textit{updatedTrip}.
  \item exception: none
\end{itemize}

\noindent createItem(\textit{itemString}):
\begin{itemize}
  \item transition: none
  \item output: Let itemComponents = \text{\textit{itemString}.split}(" ") \\
                $out :=$ new Item(itemComponents[0], itemComponents[1], itemComponents[2])
  \item exception: none
\end{itemize}

\noindent updateItem(\textit{updatedItem}):
\begin{itemize}
  \item transition: none
  \item output: $out :=$ Update all fields of the \textit{Item} object with non-empty fields of \textit{updatedItem}.
  \item exception: none
\end{itemize}

\noindent confirmGroceryTrip(\textit{groceryTrip}):
\begin{itemize}
  \item transition: Formats \textit{groceryTrip} into a JSON format, saves JSON \textit{groceryTrip} to database (Section \ref{mDBDriver}).
  \item output: $out := $ A JSON object such that each key-value pair matches that of the \textit{groceryTrip}
                fields.
  \item exception: none
\end{itemize}

\subsubsection{Local Functions}

\noindent getDateTime(\textit{receiptData}):
\begin{itemize}
  \item transition: none
  \item output: $\text{Let } A=\{x : 0 \leq x \leq 9\}, B=\{x : 0 \leq x \leq 2\}, C=\{x : 0 \leq x \leq 5\}$ \\
                $\text{Let } containsDateTime=\exists data \in receiptData : data$\\ $\in L((A|AA)(/|-)(A|AA)(/|-)(AAAA)\text{ }(BA)\text{:}(CA)\text{:}(CA))$ \\
                $out := containsDateTime(receiptData) \Rightarrow data | \neg containsDateTime(receiptData) \Rightarrow null$
  \item exception: none
\end{itemize}

\noindent getLocation(\textit{receiptData}):
\begin{itemize}
  \item transition: none
  \item output: $\text{Let } A=\{x : 0 \leq x \leq 9\}, B=\{a,b,\dots,y,z\}\cup\{A,B,\dots,Y,Z\}\cup\{\text{ }\}$ \\
                $\text{Let } containsLocation=\exists data \in receiptData : data \in L(A{}^\ast \text{ } B{}^\ast)$ \\
                $out := containsLocation(receiptData) \Rightarrow data | \neg containsLocation(receiptData) \Rightarrow null$
  \item exception: none
\end{itemize}

\noindent getItems(\textit{receiptData}):
\begin{itemize}
  \item transition: none
  \item output: $\text{Let } A=\{x : 0 \leq x \leq 9\}, B=\{a,b,\dots,y,z\}\cup\{A,B,\dots,Y,Z\}\cup\{\text{ }\}$ \\
                $\text{Let } getItems=\exists data : data \in L(B^\ast \text{ } (\$|\epsilon)A{}^\ast.AA), itemList=[]$ \\
                $out := itemList \text{ s.t. } \forall text(getItems(text) \land text \in receiptData) : itemList.append(createItem(text))$
  \item exception: none
\end{itemize}

\noindent getSubtotal(\textit{receiptData}):
\begin{itemize}
  \item transition: none
  \item output: $\text{Let } A=\{x : 0 \leq x \leq 9\}$ \\
                $\text{Let } containsSubtotal=\exists data \in receiptData : data \in L((\text{SUBTOTAL}|\text{Subtotal})\text{ }\$A{}^\ast.AA)$ \\
                $out := containsSubtotal(receiptData) \Rightarrow data | \neg containsSubtotal(receiptData) \Rightarrow null$
  \item exception: none
\end{itemize}

\noindent getTotal(\textit{receiptData}):
\begin{itemize}
  \item transition: none
  \item output: $\text{Let } A=\{x : 0 \leq x \leq 9\}$ \\
                $\text{Let } containsTotal=\exists data \in receiptData : data \in L((\text{TOTAL}|\text{Total})\text{ }\$A{}^\ast.AA)$ \\
                $out := containsTotal(receiptData) \Rightarrow data | \neg containsTotal(receiptData) \Rightarrow null$
  \item exception: none
\end{itemize}

\newpage

\section{MIS of Location Management Module} \label{mLocation} 
The Location Management Module manages user location data and outputs relevant resources based the available user location data.

\subsection{Module}

locationManagement

\subsection{Uses}

 Database Driver Module (Section \ref{mDBDriver})

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Types}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{3cm} p{3cm} p{5cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
getLastLocation & - & String & noLocationSavedException \\
setLastLocation & String & - & invalidLocationException \\
getNearbyStores & - & List$<$String$>$ & - \\
setRadius & $\mathbb{N}$ & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
None

\subsubsection{Environment Variables}
None

\subsubsection{Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent getLastLocation():
\begin{itemize}
\item transition: none
\item output: \( \textit{out} \coloneqq \neg location = null \Rightarrow  location \), where \textit{location} is the user location stored in the database (Section \ref{mDBDriver})
\item exception: \( \textit{exc} \coloneqq location = null \Rightarrow  noLocationSavedException \), where \textit{location} is the user location stored in the database (Section \ref{mDBDriver})
\end{itemize}

\noindent setLastLocation(\textit{location}):
\begin{itemize}
\item transition: Set user location in the database (Section \ref{mDBDriver}) to \textit{location}
\item output: none
\item exception: \( \textit{exc} \coloneqq invalidLocationException \), if \textit{location} is not a valid location in the places dependency
\end{itemize}

\noindent getNearbyStores():
\begin{itemize}
\item transition: none
\item output: \( \textit{out} \coloneqq locations \), where textit{locations} is a List of Strings representing relevant stores specified by the user's preferences stored in the database (Section \ref{mDBDriver})
\item exception: none
\end{itemize}

\noindent setRadius(\textit{R}):
\begin{itemize}
\item transition: Set user location radius in the database (Section \ref{mDBDriver}) to \textit{R}
\item output: none
\item exception: none
\end{itemize}


\subsubsection{Local Functions}
None

\newpage

\section{MIS of Users Module} \label{mUsers} 
The Users Module exists to handle CRUD operations for operations related to users and their grocery trips.

\subsection{Module}

users

\subsection{Uses}

 Database Driver Module (Section \ref{mDBDriver}) 

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Types}
\textbf{Item} as defined in Section \ref{mExtraction} \\

\noindent \textbf{GroceryTrip} as defined in Section \ref{mExtraction} \\

\noindent \textbf{User}

\begin{table}[H]
  \begin{tabular}{|p{0.25\textwidth}|p{0.25\textwidth}|p{0.40\textwidth}|}
    \hline
    \textbf{Output Name} & \textbf{Output Type} & \textbf{Description} \\
    \hline
    userId & String & Unique user id number \\
    \hline
    email & String & Email of user \\
    \hline
    password & String & Password of user (Encrypted) \\
    \hline
    firstName & String & First name of User \\
    \hline
    lastName & String & Last name of User \\
    \hline
    location & String & Location of user's home-base. (Coordinates) \\
    \hline
  \end{tabular}
\end{table}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{3cm} p{3cm} p{5cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
newUser & User & - & userExistsException \\
getUser & String & User & userDneException \\
updateUser & User & - & userDneException \\
deleteUser & String & - & userDneException \\
addTrip & GroceryTrip & - & userDneException \\
getTrip & $\mathbb{N}$ & GroceryTrip & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
None

\subsubsection{Environment Variables}
None 

\subsubsection{Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent newUser(\textit{user}):
\begin{itemize}
\item transition: \( \neg userExists(\textit{user.userId}) \Rightarrow addUserInDB(\textit{user})\) 
\item output: none
\item exception \( \textit{exc} \coloneqq userExists(\textit{user.userId}) \Rightarrow \\ userExistsException\)
\end{itemize}

\noindent getUser(\textit{userId}):
\begin{itemize}
\item transition: none
\item output: \( \textit{out} \coloneqq userExists(\textit{user.userId}) \Rightarrow getUserInDB(userId)\)
\item exception \( \textit{exc} \coloneqq \neg userExists(\textit{user.userId}) \Rightarrow \\ userDneException\)
\end{itemize}

\noindent updateUser(\textit{user}):
\begin{itemize}
\item transition: \( userExists(\textit{user.userId}) \Rightarrow updateUser(\textit{user})\)
\item output: none
\item exception \( \textit{exc} \coloneqq \neg userExists(\textit{user.userId}) \Rightarrow \\ userDneException\)
\end{itemize}

\noindent deleteUser(\textit{user}):
\begin{itemize}
\item transition: \( userExists(\textit{user.userId}) \Rightarrow deleteUserInDB(\textit{user})\) 
\item output: none
\item exception \( \textit{exc} \coloneqq \neg userExists(\textit{user.userId}) \Rightarrow \\ userDneException\)
\end{itemize}

\noindent addTrip(\textit{groceryTrip}):
\begin{itemize}
\item transition: \( userExists(\textit{groceryTrip.userId}) \Rightarrow addTripInDB(\textit{groceryTrip})\) 
\item output: none
\item exception \( \textit{exc} \coloneqq \neg userExists(\textit{user.userId}) \Rightarrow \\ userDneException\)
\end{itemize}

\noindent getTrip(\textit{dateTime}):
\begin{itemize}
\item transition: none
\item output: \( \textit{out} \coloneqq getTripFromDateTime(\textit{dateTime}) \)
\end{itemize}

\subsubsection{Local Functions}
addUserInDB(\textit{user})
\begin{itemize}
\item transition: Add tuple to User database (Section \ref{mDBDriver}) using fields from \textit{user}.
\end{itemize}

\noindent getUserInDB(\textit{userId})
\begin{itemize}
\item output:  Query User database (Section \ref{mDBDriver}) where \textit{userId} and map to fields in \textit{user}. Output \textit{user}.
\end{itemize}

\noindent updateUserInDB(\textit{user})
\begin{itemize}
\item output:  Replace tuple with key \textit{user.userId} in User database (Section \ref{mDBDriver}) with \textit{user} by mapping fields fields.
\end{itemize}

\noindent deleteUserInDB(\textit{user})
\begin{itemize}
\item transition: Remove tuple to User database (Section \ref{mDBDriver}) using fields from primary key \textit{user.userId}.
\end{itemize}

\noindent userExists(\textit{groceryTrip.userId})
\begin{itemize}
\item output: Query User database (Section \ref{mDBDriver}) and output True if a tuple with \textit{userId} == \textit{groceryTrip.userId} exists in the table.
\end{itemize}

\noindent addTripInDB(\textit{groceryTrip})
\begin{itemize}
\item transition: Add tuple to Trip database (Section \ref{mDBDriver}) using fields from \textit{groceryTrip}.
\end{itemize}

\noindent getTripFromDateTime(\textit{dateTime})
\begin{itemize}
\item output: Query Trip database (Section \ref{mDBDriver}) and output the \textbf{GroceryTrip} tuple that is closest to \textit{dateTime}.
\end{itemize}

\newpage

\section{MIS of Authentication Module} \label{mAuthentication} 
The Authentication module acts to "log-in" the user by providing the client with a JWT token.

\subsection{Module}

authentication

\subsection{Uses}

 Database Driver Module (Section \ref{mDBDriver}) 

\subsection{Syntax}

\subsubsection{Exported Constants}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{3cm} p{3cm} p{5cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
getToken & String, String & String & invalidCredentialsException \\
verifyToken & String & String & invalidTokenException \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
None

\subsubsection{Environment Variables}
PrivateKey (for JWT) \\
PublicKey (for JWT)

\subsubsection{Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent getToken(\textit{email}, \textit{passwordEncrypted}):
\begin{itemize}
\item transition: \textit{signedJwtToken} produced using \textit{PrivateKey}
\item output: \( \textit{out} \coloneqq verifyCredentials(\textit{email}, \textit{passwordEncrypted}) \Rightarrow  signedJwtToken\) \\
\item exception \( \textit{exc} \coloneqq \neg verifyCredentials(\textit{email}, \textit{passwordEncrypted}) \Rightarrow \\ invalidCredentialsException\)
\end{itemize}

\noindent verifyJwtToken(\textit{jwtToken}):
\begin{itemize}
\item transition: none
\item output: \( \textit{out} \coloneqq verifyToken(\textit{jwtToken})\)
\item exception: \( \textit{exc} \coloneqq \neg verifyToken(\textit{jwtToken}) \Rightarrow invalidTokenException \), if the provided JWT token does not evaluate true in comparison to the PublicKey
\end{itemize}

\subsubsection{Local Functions}
verifyCredentials(\textit{email}, \textit{passwordEncrypted})
\begin{itemize}
\item output: \( \textit{out} \coloneqq \) True if the password is deemed correct for the given email using the database (Section \ref{mDBDriver})
\end{itemize}

\noindent verifyToken(\textit{jwtToken})
\begin{itemize}
\item output: \( \textit{out} \coloneqq \) True if the JWT token is deemed corrrect using the PublicKey and JWTLibrary
\end{itemize}

\newpage

\bibliographystyle {plainnat}
\bibliography {../../../refs/References}

\newpage

\section{Appendix} \label{Appendix}

\subsection{Database Schema and Tables} \label{dbAppendix}

\subsubsection{rawItems}
\begin{table}[H]
  \begin{tabular}{|p{0.2\linewidth}|p{0.2\linewidth}|p{0.5\linewidth}|}
    \hline
    \textbf{Column Name} & \textbf{Type} & \textbf{Description} \\
    \hline
    itemId & INT & PRIMARY KEY unique id of this instance of this item \\
    \hline
    itemKey & VARCHAR & Item identifier specific to the retailer (usually SKU) \\
    \hline
    dateTime & DATETIME & Date and time of purchase \\
    \hline
    price & DOUBLE & Price of item \\
    \hline
    location & VARCHAR & Location of purchase \\
    \hline
    userId & INT & FOREIGN KEY ID of user\\
    \hline
    itemDesc & VARCHAR & Item description\\
    \hline
    isTaxed & BOOL & Describes if the item is taxed\\
    \hline
  \end{tabular}
\end{table}

\subsubsection{classifiedItems}
\begin{table}[H]
  \begin{tabular}{|p{0.2\linewidth}|p{0.2\linewidth}|p{0.5\linewidth}|}
    \hline
    \textbf{Column Name} & \textbf{Type} & \textbf{Description} \\
    \hline
    itemId & INT & PRIMARY KEY unique id of this instance of this item \\
    \hline
    productKey & VARCHAR & Universal item identifier (UPC) \\
    \hline
    dateTime & DATETIME & Date and time of purchase \\
    \hline
    price & DOUBLE & Price of item \\
    \hline
    location & VARCHAR & Location of purchase \\
    \hline
    userId & INT & FOREIGN KEY ID of user\\
    \hline
    itemDesc & VARCHAR & Item description\\
    \hline
    isTaxed & BOOL & Describes if the item is taxed\\
    \hline
    category & VARCHAR & Describes the product category the item belongs to\\
    \hline
  \end{tabular}
\end{table}

\subsubsection{users}
\begin{table}[H]
  \begin{tabular}{|p{0.2\linewidth}|p{0.2\linewidth}|p{0.5\linewidth}|}
    \hline
    \textbf{Column Name} & \textbf{Type} & \textbf{Description} \\
    \hline
    userId & INT & PRIMARY KEY unique id assigned to the user \\
    \hline
    email & VARCHAR & User email \\
    \hline
    password & VARCHAR & Encrypted user password \\
    \hline
    firstName & VARCHAR & User first name \\
    \hline
    lastName & VARCHAR & User last name \\
    \hline
    location & VARCHAR & Location of the user, usually describes the user's home\\
    \hline
  \end{tabular}
\end{table}

\subsubsection{goals}
\begin{table}[H]
  \begin{tabular}{|p{0.2\linewidth}|p{0.2\linewidth}|p{0.5\linewidth}|}
    \hline
    \textbf{Column Name} & \textbf{Type} & \textbf{Description} \\
    \hline
    goalId & INT & PRIMARY KEY unique id assigned to the goal \\
    \hline
    userId & INT & FOREIGN KEY ID of user \\
    \hline
    startDate & DATE & Start date of the goal \\
    \hline
    endDate & DATE & End date of the goal \\
    \hline
    budget & INT & Money allotted for the goal \\
    \hline
    category & VARCHAR & The product category of relevant to the goal\\
    \hline
  \end{tabular}
\end{table}


\end{document}
